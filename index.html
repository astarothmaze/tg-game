<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DevOps: Singularity v2</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* --- ROCKSTAR VISUALS --- */
        :root {
            --primary: #00ff41;
            --accent: #00f0ff; /* Cyber Blue */
            --gold: #ffd700;
            --alert: #ff0055;
            --bg: #050505;
            --panel: rgba(0, 20, 0, 0.85);
            --font-main: 'Share Tech Mono', monospace;
        }

        body {
            background-color: #000;
            color: var(--primary);
            font-family: var(--font-main);
            margin: 0;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background-image: radial-gradient(circle at 50% 50%, #111 0%, #000 100%);
        }

        /* --- FX --- */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            pointer-events: none; z-index: 999; opacity: 0.7;
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 50%, black 100%);
            pointer-events: none; z-index: 998;
        }
        
        /* --- LAYOUT --- */
        header {
            padding: 15px;
            background: rgba(0, 10, 0, 0.9);
            border-bottom: 1px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .currency-val { font-size: 22px; text-shadow: 0 0 10px var(--primary); color: #fff; letter-spacing: 1px; }
        .sub-currency { font-size: 11px; color: var(--accent); letter-spacing: 1px; }

        main {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- TABS --- */
        .tab-content {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            padding-bottom: 100px;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s, transform 0.3s;
        }
        .tab-content.active { display: block; opacity: 1; transform: translateY(0); }

        nav {
            position: fixed; bottom: 20px; left: 5%; width: 90%;
            background: rgba(0, 20, 0, 0.9);
            display: flex;
            justify-content: space-between;
            padding: 5px;
            border: 1px solid var(--primary);
            border-radius: 30px;
            z-index: 20;
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
        .nav-btn {
            background: none; border: none;
            color: rgba(255,255,255,0.5); padding: 10px 0;
            font-family: var(--font-main); font-weight: bold;
            font-size: 18px; cursor: pointer; flex: 1;
            border-radius: 25px;
            transition: 0.2s;
        }
        .nav-btn.active { background: var(--primary); color: #000; box-shadow: 0 0 15px var(--primary); }

        /* --- TERMINAL & COMBO --- */
        #terminal-view {
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            position: relative;
        }
        
        #combo-container {
            position: absolute; top: 20px; width: 100%;
            display: flex; flex-direction: column; align-items: center;
            opacity: 0; transition: opacity 0.3s;
        }
        #combo-text { font-size: 24px; color: var(--accent); font-weight: bold; text-shadow: 0 0 10px var(--accent); }
        #combo-bar-bg { width: 150px; height: 4px; background: #333; margin-top: 5px; border-radius: 2px; }
        #combo-bar-fill { height: 100%; background: var(--accent); width: 0%; box-shadow: 0 0 5px var(--accent); transition: width 0.1s linear; }

        #hack-btn {
            width: 220px; height: 220px;
            border-radius: 50%;
            background: radial-gradient(circle, #002200 0%, #000 80%);
            border: 2px solid var(--primary);
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.1), inset 0 0 20px rgba(0, 255, 65, 0.2);
            color: var(--primary);
            display: flex; align-items: center; justify-content: center;
            flex-direction: column;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.1s;
            z-index: 5;
        }
        #hack-btn::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: repeating-linear-gradient(transparent, transparent 5px, rgba(0, 255, 65, 0.05) 5px, rgba(0, 255, 65, 0.05) 10px);
            animation: spin 10s linear infinite;
        }
        #hack-btn:active { transform: scale(0.96); box-shadow: 0 0 50px rgba(0, 255, 65, 0.4); border-color: #fff; }
        
        /* --- SHOP & CARDS --- */
        .item-card {
            background: linear-gradient(90deg, rgba(0,20,0,0.6) 0%, rgba(0,10,0,0.2) 100%);
            border-left: 3px solid var(--primary);
            border-bottom: 1px solid #111;
            margin-bottom: 8px; padding: 12px;
            display: flex; justify-content: space-between; align-items: center;
            transition: transform 0.2s;
        }
        .item-card:active { transform: translateX(5px); background: rgba(0, 40, 0, 0.8); }
        .item-info h4 { margin: 0; color: #fff; font-size: 16px; letter-spacing: 0.5px; }
        .item-info p { margin: 4px 0 0; font-size: 12px; opacity: 0.6; color: #aaa; }
        .buy-btn {
            background: transparent; color: var(--primary);
            border: 1px solid var(--primary); padding: 8px 16px;
            font-family: var(--font-main); font-weight: bold; cursor: pointer;
            min-width: 90px; text-align: right;
            transition: all 0.2s;
        }
        .buy-btn:active { background: var(--primary); color: #000; }
        .buy-btn:disabled { border-color: #333; color: #555; pointer-events: none; }

        /* --- DARK WEB (PRESTIGE) --- */
        .dark-card { border-left-color: var(--alert); background: linear-gradient(90deg, rgba(20,0,5,0.6) 0%, rgba(0,0,0,0) 100%); }
        .dark-btn { border-color: var(--alert); color: var(--alert); }
        .dark-btn:active { background: var(--alert); color: #fff; }

        /* --- PARTICLES & GLITCHES --- */
        .particle {
            position: absolute; pointer-events: none;
            font-weight: bold; font-size: 20px;
            text-shadow: 0 0 5px currentColor;
            animation: floatUp 0.8s forwards;
            z-index: 100;
        }
        
        .glitch-node {
            position: absolute; width: 40px; height: 40px;
            background: var(--gold); border-radius: 50%;
            box-shadow: 0 0 20px var(--gold);
            cursor: pointer; z-index: 50;
            animation: pulse 1s infinite;
            display: flex; justify-content: center; align-items: center;
            font-size: 20px; color: #000; font-weight: bold;
        }

        /* --- LOGS --- */
        #log-container {
            font-size: 12px; opacity: 0.8;
            text-align: left; width: 100%; max-height: 120px;
            overflow: hidden;
            position: absolute; bottom: 80px; left: 0;
            background: linear-gradient(to top, #000 0%, transparent 100%);
            pointer-events: none; padding-left: 15px;
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 20%);
        }
        .log-line { margin: 4px 0; text-shadow: 0 0 2px #000; }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-60px) scale(1.2); }
        }
    </style>
</head>
<body>
    <div class="scanlines"></div>
    <div class="vignette"></div>

    <!-- HEADER -->
    <header>
        <div>
            <div class="sub-currency">BALANCE</div>
            <div class="currency-val" id="display-money">$0</div>
        </div>
        <div style="text-align: right;">
            <div class="sub-currency">INCOME</div>
            <div style="font-size: 16px; color: var(--primary);" id="display-income">$0/s</div>
        </div>
    </header>

    <!-- MAIN -->
    <main>
        <!-- TAB: TERMINAL -->
        <div id="tab-terminal" class="tab-content active">
            <div id="terminal-view">
                <div id="combo-container">
                    <div id="combo-text">x1.0 COMBO</div>
                    <div id="combo-bar-bg"><div id="combo-bar-fill"></div></div>
                </div>

                <div id="hack-btn" onpointerdown="game.click(event)">
                    <div style="font-size: 40px; margin-bottom: 5px;">$</div>
                    <div style="font-size: 10px; letter-spacing: 2px;">MINING...</div>
                </div>
                
                <div id="log-container"></div>
            </div>
        </div>

        <!-- TAB: HARDWARE -->
        <div id="tab-hardware" class="tab-content">
            <h3 style="padding-left: 10px; color: var(--primary);">INFRASTRUCTURE</h3>
            <div id="hardware-list"></div>
        </div>

        <!-- TAB: SOFTWARE -->
        <div id="tab-software" class="tab-content">
            <h3 style="padding-left: 10px; color: var(--accent);">SOFTWARE & PATCHES</h3>
            <div id="software-list"></div>
        </div>
        
        <!-- TAB: DARK WEB (NEW) -->
        <div id="tab-darkweb" class="tab-content">
            <div style="background: rgba(255, 0, 85, 0.1); padding: 15px; border: 1px solid var(--alert); margin-bottom: 20px;">
                <h3 style="color: var(--alert); margin: 0;">PRESTIGE: SYSTEM REBOOT</h3>
                <p style="font-size: 12px; color: #fff;">Wipe all hardware to gain Bio-Chips.</p>
                <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                    <span>Current Chips:</span>
                    <span id="display-prestige" style="color: var(--alert); font-weight: bold;">0</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin: 10px 0;">
                    <span>Pending Chips:</span>
                    <span id="pending-chips" style="color: #fff; font-weight: bold;">0</span>
                </div>
                <button class="buy-btn dark-btn" style="width: 100%; text-align: center;" onclick="game.prestige()">WIPE & REBOOT</button>
            </div>
            
            <h3 style="padding-left: 10px; color: var(--alert);">BLACK MARKET</h3>
            <div id="darkweb-list"></div>
            
            <button class="buy-btn" style="width: 100%; margin-top: 30px; border-color: #555; color: #777;" onclick="game.hardReset()">HARD RESET SAVE</button>
        </div>
    </main>

    <!-- NAV -->
    <nav>
        <button class="nav-btn active" onclick="ui.switchTab('terminal')">&#9000;</button>
        <button class="nav-btn" onclick="ui.switchTab('hardware')">&#128187;</button>
        <button class="nav-btn" onclick="ui.switchTab('software')">&#128190;</button>
        <button class="nav-btn" onclick="ui.switchTab('darkweb')">&#9760;</button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        tg.enableClosingConfirmation();

        /* --- AUDIO --- */
        const audio = {
            ctx: null,
            init: () => { if (!audio.ctx) audio.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            play: (freq, type, dur, vol = 0.1) => {
                if (!audio.ctx) audio.init();
                const o = audio.ctx.createOscillator();
                const g = audio.ctx.createGain();
                o.type = type; o.frequency.value = freq;
                g.gain.setValueAtTime(vol, audio.ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audio.ctx.currentTime + dur);
                o.connect(g); g.connect(audio.ctx.destination);
                o.start(); o.stop(audio.ctx.currentTime + dur);
            },
            click: () => audio.play(600 + Math.random()*200, 'triangle', 0.1, 0.05),
            cash: () => audio.play(1200, 'sine', 0.3, 0.1),
            error: () => audio.play(150, 'sawtooth', 0.3, 0.1),
            glitch: () => audio.play(2000, 'square', 0.1, 0.05)
        };

        /* --- DATA --- */
        const DB = {
            hardware: [
                { id: 'h1', name: 'Script Kiddie PC', cost: 15, inc: 1, desc: 'Your mom\'s laptop.' },
                { id: 'h2', name: 'GPU Mining Rig', cost: 120, inc: 5, desc: 'Overheated and loud.' },
                { id: 'h3', name: 'Botnet Cluster', cost: 1100, inc: 35, desc: 'Infected smart fridges.' },
                { id: 'h4', name: 'Server Farm', cost: 12000, inc: 150, desc: 'Dedicated AC required.' },
                { id: 'h5', name: 'Quantum Node', cost: 130000, inc: 700, desc: 'Breaks encryption instantly.' },
                { id: 'h6', name: 'AI Supervisor', cost: 1500000, inc: 4000, desc: 'It demands to be paid.' },
                { id: 'h7', name: 'Orbital Uplink', cost: 20000000, inc: 18000, desc: 'Worldwide coverage.' }
            ],
            software: [
                { id: 's1', name: 'Auto-Clicker v1', cost: 500, type: 'click', mul: 2, desc: 'Click Power x2' },
                { id: 's2', name: 'Efficiency Patch', cost: 2000, type: 'all', mul: 2, desc: 'Passive Income x2' },
                { id: 's3', name: 'Neural Link', cost: 10000, type: 'click', mul: 3, desc: 'Click Power x3' },
                { id: 's4', name: 'DeFi Protocol', cost: 50000, type: 'all', mul: 1.5, desc: 'Passive Income x1.5' }
            ],
            darkweb: [
                { id: 'd1', name: 'Starter Kit', cost: 5, desc: 'Start resets with $500', once: true },
                { id: 'd2', name: 'Insider Trading', cost: 20, desc: '+25% Passive Income (Stackable)', once: false },
                { id: 'd3', name: 'Legacy Code', cost: 50, desc: 'Keep Software upgrades after reset', once: true }
            ]
        };

        /* --- GAME ENGINE --- */
        const game = {
            state: {
                money: 0,
                totalMoney: 0,
                chips: 0,
                hw: {},
                sw: [],
                dw: {}, // Dark web upgrades
                lastSave: Date.now(),
                startTime: Date.now()
            },
            combo: 0,
            comboTimer: 0,

            init: () => {
                DB.hardware.forEach(h => { if(!game.state.hw[h.id]) game.state.hw[h.id] = 0; });
                DB.darkweb.forEach(d => { if(!game.state.dw[d.id]) game.state.dw[d.id] = 0; });
                
                game.load();
                
                // Welcome back
                const diff = (Date.now() - game.state.lastSave) / 1000;
                if(diff > 60) {
                    const gain = game.calcIncome() * diff;
                    if(gain > 0) {
                        game.addMoney(gain);
                        ui.log(`OFFLINE INCOME: $${ui.fmt(gain)}`);
                    }
                }
                
                requestAnimationFrame(game.loop);
                setInterval(game.save, 5000);
                setInterval(game.spawnGlitch, Math.random() * 30000 + 30000); // Random event 30-60s
                ui.renderAll();
            },

            loop: () => {
                const now = Date.now();
                const dt = (now - game.lastTick) / 1000 || 0.016;
                game.lastTick = now;

                // Income
                game.addMoney(game.calcIncome() * dt);

                // Combo Decay
                if (game.combo > 0) {
                    game.comboTimer -= dt;
                    if (game.comboTimer <= 0) {
                        game.combo = 0;
                        ui.updateCombo();
                    }
                }

                ui.updateRealtime();
                requestAnimationFrame(game.loop);
            },

            click: (e) => {
                // Combo Logic
                game.combo++;
                game.comboTimer = 2.0; // Seconds to keep combo
                if(game.combo > 50) game.combo = 50;
                
                const comboMult = 1 + (game.combo * 0.05); // Max 3.5x
                const power = game.calcClickPower() * comboMult;
                
                game.addMoney(power);
                audio.click();
                tg.HapticFeedback.impactOccurred(game.combo > 10 ? 'heavy' : 'light');
                
                ui.spawnParticle(e.clientX, e.clientY, `+$${ui.fmt(power)}`, '#fff');
                ui.updateCombo();
            },

            addMoney: (amt) => {
                game.state.money += amt;
                game.state.totalMoney += amt;
            },

            buy: (type, id) => {
                if (type === 'hw') {
                    const item = DB.hardware.find(i => i.id === id);
                    const cost = Math.floor(item.cost * Math.pow(1.15, game.state.hw[id]));
                    if (game.state.money >= cost) {
                        game.state.money -= cost;
                        game.state.hw[id]++;
                        audio.cash();
                        ui.renderAll();
                    }
                } else if (type === 'sw') {
                    const item = DB.software.find(i => i.id === id);
                    if (game.state.money >= item.cost) {
                        game.state.money -= item.cost;
                        game.state.sw.push(id);
                        audio.cash();
                        ui.renderAll();
                    }
                } else if (type === 'dw') {
                    const item = DB.darkweb.find(i => i.id === id);
                    const currentLevel = game.state.dw[id];
                    if (game.state.chips >= item.cost && (!item.once || currentLevel === 0)) {
                        game.state.chips -= item.cost;
                        game.state.dw[id]++;
                        audio.cash();
                        ui.renderAll();
                    }
                }
            },

            calcIncome: () => {
                let inc = 0;
                DB.hardware.forEach(h => inc += h.inc * game.state.hw[h.id]);
                
                // Multipliers
                if(game.state.sw.includes('s2')) inc *= 2;
                if(game.state.sw.includes('s4')) inc *= 1.5;
                
                // Dark Web
                inc *= (1 + (game.state.dw['d2'] * 0.25)); // +25% per level
                inc *= (1 + (game.state.chips * 0.1)); // 10% per chip

                return inc;
            },

            calcClickPower: () => {
                let p = 1 + (game.calcIncome() * 0.02); // 2% of income
                if(game.state.sw.includes('s1')) p *= 2;
                if(game.state.sw.includes('s3')) p *= 3;
                return p;
            },

            // Prestige
            calcPendingChips: () => {
                if(game.state.totalMoney < 1000000) return 0;
                return Math.floor(Math.cbrt(game.state.totalMoney / 1000000)) - game.state.chips;
            },
            
            prestige: () => {
                const pending = game.calcPendingChips();
                if(pending <= 0) return;
                
                if(confirm("REBOOT SYSTEM?")) {
                    game.state.chips += pending;
                    game.state.money = game.state.dw['d1'] ? 500 : 0; // Starter Kit
                    game.state.hw = {};
                    DB.hardware.forEach(h => game.state.hw[h.id] = 0);
                    
                    if(!game.state.dw['d3']) game.state.sw = []; // Keep software if upgrade
                    
                    game.state.startTime = Date.now();
                    game.save();
                    location.reload();
                }
            },
            
            spawnGlitch: () => {
                const el = document.createElement('div');
                el.className = 'glitch-node';
                el.innerText = '?';
                el.style.left = Math.random() * (window.innerWidth - 50) + 'px';
                el.style.top = Math.random() * (window.innerHeight - 150) + 'px';
                
                el.onclick = () => {
                    audio.glitch();
                    const bonus = game.calcIncome() * 60; // 1 min bonus
                    game.addMoney(bonus);
                    ui.spawnParticle(parseInt(el.style.left), parseInt(el.style.top), `JACKPOT $${ui.fmt(bonus)}`, '#ffd700');
                    tg.HapticFeedback.notificationOccurred('success');
                    el.remove();
                };
                
                document.body.appendChild(el);
                setTimeout(() => { if(el.parentNode) el.remove(); }, 5000);
            },

            save: () => localStorage.setItem('devopsSingularityV2', btoa(JSON.stringify(game.state))),
            load: () => {
                const d = localStorage.getItem('devopsSingularityV2');
                if(d) try { game.state = {...game.state, ...JSON.parse(atob(d))}; } catch(e){}
            },
            hardReset: () => { localStorage.removeItem('devopsSingularityV2'); location.reload(); }
        };

        /* --- UI --- */
        const ui = {
            fmt: (n) => {
                if(n < 1000) return Math.floor(n);
                if(n < 1000000) return (n/1000).toFixed(1) + 'k';
                if(n < 1000000000) return (n/1000000).toFixed(2) + 'M';
                return (n/1000000000).toFixed(2) + 'B';
            },
            
            switchTab: (id) => {
                document.querySelectorAll('.tab-content').forEach(e => e.classList.remove('active'));
                document.getElementById('tab-'+id).classList.add('active');
                document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
                event.currentTarget.classList.add('active');
                ui.renderAll();
            },
            
            updateRealtime: () => {
                document.getElementById('display-money').innerText = '$' + ui.fmt(game.state.money);
                document.getElementById('display-income').innerText = '$' + ui.fmt(game.calcIncome()) + '/s';
                
                // Hardware buttons state
                DB.hardware.forEach(h => {
                    const btn = document.getElementById('btn-hw-'+h.id);
                    if(btn) {
                        const cost = Math.floor(h.cost * Math.pow(1.15, game.state.hw[h.id]));
                        btn.disabled = game.state.money < cost;
                        btn.innerText = '$' + ui.fmt(cost);
                    }
                });
                
                // Prestige Preview
                if(document.getElementById('tab-darkweb').classList.contains('active')) {
                    document.getElementById('display-prestige').innerText = game.state.chips;
                    const p = game.calcPendingChips();
                    document.getElementById('pending-chips').innerText = p > 0 ? '+' + p : '0';
                }
            },
            
            updateCombo: () => {
                const c = document.getElementById('combo-container');
                if(game.combo > 0) {
                    c.style.opacity = 1;
                    document.getElementById('combo-text').innerText = `x${(1 + game.combo * 0.05).toFixed(1)} COMBO`;
                    document.getElementById('combo-bar-fill').style.width = (game.comboTimer / 2.0 * 100) + '%';
                } else {
                    c.style.opacity = 0;
                }
            },
            
            renderAll: () => {
                // Render Hardware
                const hList = document.getElementById('hardware-list');
                hList.innerHTML = '';
                DB.hardware.forEach(h => {
                    const cost = Math.floor(h.cost * Math.pow(1.15, game.state.hw[h.id]));
                    const count = game.state.hw[h.id];
                    hList.innerHTML += `
                        <div class="item-card">
                            <div class="item-info">
                                <h4>${h.name} <span style="color:var(--primary)">[${count}]</span></h4>
                                <p>${h.desc} (+$${ui.fmt(h.inc)}/s)</p>
                            </div>
                            <button id="btn-hw-${h.id}" class="buy-btn" onclick="game.buy('hw', '${h.id}')">$${ui.fmt(cost)}</button>
                        </div>`;
                });
                
                // Render Software
                const sList = document.getElementById('software-list');
                sList.innerHTML = '';
                DB.software.forEach(s => {
                    if(!game.state.sw.includes(s.id)) {
                        sList.innerHTML += `
                        <div class="item-card" style="border-left-color: var(--accent)">
                            <div class="item-info">
                                <h4 style="color: var(--accent)">${s.name}</h4>
                                <p>${s.desc}</p>
                            </div>
                            <button class="buy-btn" style="border-color: var(--accent); color: var(--accent)" 
                                onclick="game.buy('sw', '${s.id}')">$${ui.fmt(s.cost)}</button>
                        </div>`;
                    }
                });
                if(sList.innerHTML === '') sList.innerHTML = '<div style="text-align:center; opacity:0.5; padding:20px;">SYSTEM FULLY PATCHED</div>';
                
                // Render Dark Web
                const dList = document.getElementById('darkweb-list');
                dList.innerHTML = '';
                DB.darkweb.forEach(d => {
                    const lvl = game.state.dw[d.id];
                    if(!d.once || lvl === 0) {
                        dList.innerHTML += `
                        <div class="item-card dark-card">
                            <div class="item-info">
                                <h4 style="color: var(--alert)">${d.name} ${d.once ? '' : '(Lvl '+lvl+')'}</h4>
                                <p style="color: #aaa">${d.desc}</p>
                            </div>
                            <button class="buy-btn dark-btn" onclick="game.buy('dw', '${d.id}')">
                                Èº${d.cost}
                            </button>
                        </div>`;
                    }
                });
            },
            
            log: (txt) => {
                const box = document.getElementById('log-container');
                const d = document.createElement('div');
                d.className = 'log-line';
                d.innerText = `> ${txt}`;
                box.prepend(d);
                if(box.children.length > 5) box.lastChild.remove();
            },
            
            spawnParticle: (x, y, txt, color) => {
                const p = document.createElement('div');
                p.className = 'particle';
                p.innerText = txt;
                p.style.color = color;
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 800);
            }
        };

        window.onload = game.init;
    </script>
</body>
</html>
