<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Dodge</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: #0f0; font-family: 'Courier New', monospace; }
        canvas { display: block; }
        #ui { position: absolute; top: 10px; left: 10px; z-index: 10; font-weight: bold; font-size: 20px; pointer-events: none; }
        #gameover { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; background: rgba(0,0,0,0.9); padding: 20px; border: 2px solid #0f0; border-radius: 10px; }
        button { background: #0f0; color: #000; border: none; padding: 10px 20px; font-size: 18px; cursor: pointer; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>
    <div id="ui">Score: <span id="scoreVal">0</span></div>
    <div id="gameover">
        <h1>SYSTEM FAILURE</h1>
        <p>Score: <span id="finalScore">0</span></p>
        <button onclick="resetGame()">REBOOT</button>
    </div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const tg = window.Telegram.WebApp;
        
        // Сообщаем телеге, что мы готовы
        tg.ready();
        tg.expand(); 

        let width, height;
        let player = { x: 0, y: 0, size: 30, color: '#0f0' };
        let obstacles = [];
        let score = 0;
        let gameOver = false;
        let speed = 3;

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            player.y = height - 100;
            if (player.x === 0) player.x = width / 2;
        }
        window.addEventListener('resize', resize);
        resize();

        // Управление
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault(); // Блокируем скролл
            let touchX = e.touches[0].clientX;
            player.x = touchX;
        }, { passive: false });

        canvas.addEventListener('mousemove', (e) => {
            player.x = e.clientX;
        });

        function spawnObstacle() {
            const size = Math.random() * 50 + 20;
            obstacles.push({
                x: Math.random() * width,
                y: -size,
                size: size,
                speed: speed + Math.random() * 2
            });
        }

        function update() {
            if (gameOver) return;

            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)'; // Эффект шлейфа
            ctx.fillRect(0, 0, width, height);

            // Игрок
            ctx.fillStyle = player.color;
            ctx.shadowBlur = 15;
            ctx.shadowColor = player.color;
            ctx.fillRect(player.x - player.size/2, player.y - player.size/2, player.size, player.size);
            ctx.shadowBlur = 0;

            // Препятствия
            if (Math.random() < 0.05) spawnObstacle();

            ctx.fillStyle = '#f00';
            for (let i = 0; i < obstacles.length; i++) {
                let obs = obstacles[i];
                obs.y += obs.speed;
                ctx.fillRect(obs.x - obs.size/2, obs.y - obs.size/2, obs.size, obs.size);

                // Коллизия (простая)
                let dist = Math.hypot(player.x - obs.x, player.y - obs.y);
                if (dist < (player.size/2 + obs.size/2)) {
                    endGame();
                }

                if (obs.y > height) {
                    obstacles.splice(i, 1);
                    i--;
                    score++;
                    document.getElementById('scoreVal').innerText = score;
                    if (score % 50 === 0) speed += 0.5; // Ускорение
                }
            }
            requestAnimationFrame(update);
        }

        function endGame() {
            gameOver = true;
            tg.HapticFeedback.impactOccurred('heavy'); // Вибрация телефона через API Телеграм
            document.getElementById('gameover').style.display = 'block';
            document.getElementById('finalScore').innerText = score;
        }

        function resetGame() {
            obstacles = [];
            score = 0;
            speed = 3;
            gameOver = false;
            document.getElementById('scoreVal').innerText = '0';
            document.getElementById('gameover').style.display = 'none';
            update();
        }

        update();
    </script>
</body>
</html>
